<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 2022.02.10 윤상현 -->

<mapper namespace="mapper.adminCS">

	<!-- CS 리스트 -->
	<select id="CSList" resultType="NoticeVO" parameterType="java.util.Map">
	<if test='option = "QA"'>
		select 
			B.notice_id, 
			B.user_id, 
			B.notice_category, 
			B.notice_title, 
			B.notice_cre_Date, 
			B.notice_match_no, 
			(count(B.notice_match_no) -1) as notice_parent_no
 		from notice as A inner join notice as B on (A.notice_match_no = B.notice_id) 
		where A.notice_category in ('UQA', 'PQA') 
		group by B.notice_id 
		order by A.notice_cre_date desc
	</if>
	</select>
	
	<!-- CS 삭제 쿼리  -->
	<delete id="deleteCS" parameterType="java.lang.String">

		delete from notice, image where notice_match_no = #{notice_id}	
		
	</delete>
	
	<!-- CS 단일객체 조회 쿼리 -->
	<select id="CSDetail" resultType="NoticeVO" parameterType="java.util.Map">
		<if test='option = "UQA"'>
			select * from notice where notice_id = #{notice_id}
		</if>
		
		<if test='option = "PQA"'>
			select * from notice where notice_id = #{notice_id}
		</if>
		
		<if test='option = "comment"'>
		</if>
	</select>
	
		<!-- CS 답글 등록 쿼리 -->
	<insert id="addNotice" parameterType="NoticeVO">
	
		insert into notice (
			notice_id,
			user_id,
			notice_category,
			notice_pw,
			notice_title,
			notice_body,
			notice_grade,
			notice_private,
			notice_type,
			order_id,
			product_id,
			notice_match_no,
			notice_parent_no
			)

			values (
				select concat('notice_', (select nextval('notice'))),
				#{user_id},
				#{notice_category},
				null,
				#{notice_title},
				#{notice_body},
				null,
				null,
				null,
				null,
				null,
				#{notice_id},
				1
				)
	
	</insert>
	
</mapper>